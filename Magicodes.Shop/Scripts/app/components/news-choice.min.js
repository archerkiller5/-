var instance=function(n,t){var i=this;this.Name=ko.observable();this.Url=ko.observable("/Content/patterns/congruent_pentagon.png");this.Id=ko.observable();i.Id.subscribe(function(n){mwc.log.warn(n);mwc.restApi.get({url:"/api/News/"+n,isBlockUI:!0,blockUI:t.element,success:function(n){i.Name(n.Title);i.Url("/MediaFiles/thumb/"+n.ThumbMediaId+".jpg")}})});n&&typeof n.value()=="string"&&(n.value.subscribe(function(n){i.Id(n)}),n.value().length>0&&i.Id(n.value()));this.showLoader=ko.observable(!0);this.currentImage=ko.observable({Id:"",Name:"请选择素材（多图文）",Url:"/Content/patterns/congruent_pentagon.png"});this.pages=ko.observable([]);this.dataRows=ko.observableArray([]);this.pageSize=ko.observable(6);this.totalCount=ko.observable(0);this.currentPageIndex=ko.observable(1);this.nextPage=function(){i.currentPageIndex()<i.getTotalPages()&&i.currentPageIndex(i.currentPageIndex()+1)};this.previousPage=function(){i.currentPageIndex()>1&&i.currentPageIndex(i.currentPageIndex()-1)};this.getTotalPages=function(){var n=i.totalCount()/i.pageSize();return Math.floor(n)+(n>Math.floor(n)?1:0)};this.getPagesArr=function(){var r=i.getTotalPages(),f=r>10?10:r,n=i.currentPageIndex(),t=1,u=f;return n>5&&(r-n>5?(t=n-4,u=n+5):(t=n-9,u=r)),t<1&&(t=1),ko.utils.range(t,u)};i.currentPageIndex.subscribe(function(){i.loadData()});i.pageSize.subscribe(function(){var n=i.getTotalPages();i.pages(i.getPagesArr());i.currentPageIndex()>n&&i.currentPageIndex(1);i.loadData()});this.loadData=function(){mwc.restApi.get({url:"/api/News/"+i.currentPageIndex()+"/"+i.pageSize(),isBlockUI:!0,blockUI:t.element,success:function(n){i.dataRows(n.DataRows);i.totalCount(n.TotalItemCount);i.pages(i.getPagesArr());i.showLoader(!1)}})};this.ImageClick=function(t){i.Id(t.Id);mwc.log.debug(n.value());n.value(t.Id);$("#newsModal").modal("hide")};i.loadData()},newschoiceViewModelInstance={createViewModel:function(n,t){return new instance(n,t)}};ko.components.register("news-choice-button",{viewModel:newschoiceViewModelInstance,template:'<div class="file-box"><div class="file-box"><div class="file"><a href="#" data-toggle="modal" id="news-imageshow" data-target="#newsModal"><span class="corner"><\/span><div class="image"><img alt="image" class="img-responsive" data-bind="attr:{src:Url}"><\/div><div class="file-name" data-bind="text:Name"><\/div><\/a><\/div><\/div><\/div><button type="button" class="btn btn-primary" data-toggle="modal" data-target="#newsModal">选择素材<\/button>'});ko.components.register("news-choice-modal",{viewModel:newschoiceViewModelInstance,template:'<template id="pagesTemplate"><button type="button" class="btn btn-white" data-bind="css: { disabled: currentPageIndex() <= 1 }, click: function () { previousPage(); }"><i class="fa fa-chevron-left"><\/i><\/button><!-- ko foreach: pages --><button class="btn btn-white" data-bind="css: { active: $data == $parent.currentPageIndex() },text: $data, click: function () { $parent.currentPageIndex($data); }"><\/button><!-- /ko --><button type="button" class="btn btn-white" data-bind="css: { disabled: currentPageIndex() >= getTotalPages() }, click: function () { nextPage(); }"><i class="fa fa-chevron-right"><\/i> <\/button><\/template><div class="modal inmodal fade" id="newsModal" tabindex="-1" role="dialog" aria-hidden="true"><div class="modal-dialog modal-lg"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;<\/span><span class="sr-only">Close<\/span><\/button><h4 class="modal-title">请选择素材（点击图片）<\/h4><\/div><div class="modal-body"><div class="row" data-bind="visible:showLoader()"><div class="col-lg-12 center-block middle-box"><div class="sk-spinner sk-spinner-pulse"><\/div><\/div><\/div><div class="row" data-bind="visible:!showLoader()"><div class="col-lg-12 animated fadeInRight" data-bind="foreach: dataRows"><div class="file-box" data-bind="click:$parent.ImageClick"><div class="file"><a data-bind="attr:{href:Url}"><span class="corner"><\/span><div class="image"><img alt="image" class="img-responsive" data-bind="attr:{src:\'/MediaFiles/thumb/\'+ThumbMediaId+\'.jpg\'}"><\/div><div class="file-name" data-bind="text:Title"><\/div><\/a><\/div><\/div><\/div><div class="col-lg-12 animated fadeInLeft"><div class="form-group"><div class="col-sm-4"><div>当前为第<span data-bind="text: currentPageIndex()"><\/span>页，总共有<span data-bind="    text: getTotalPages()"><\/span>页<\/div><\/div><div class="col-sm-8"><div class="btn-group pull-right" data-bind="template: { name: \'pagesTemplate\',replaceChildren:$root }"><\/div><\/div><\/div><\/div><\/div><\/div><div class="modal-footer"><button type="button" class="btn btn-primary" data-dismiss="modal">关闭<\/button><\/div><\/div><\/div><\/div>'});
//# sourceMappingURL=news-choice.min.js.map
